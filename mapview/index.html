<!DOCTYPE html>
<html>
<head>
  <link rel="stylesheet" href="leaflet.css" />
  <link rel="stylesheet" href="MarkerCluster.css" />
  <link rel="stylesheet" href="MarkerCluster.Default.css" />
  <link rel="stylesheet" href="locationfilter.css" />
  <script src="leaflet.js"></script>
	<script src="leaflet.markercluster.js"></script>
	<script src="locationfilter.js"></script>
  <style>
    body { padding: 0; margin: 0; }
    html, body, #map { height: 100%; }
  </style>
</head>
<body>
  <div id="map"></div>
</body>
<script type="text/javascript">


console.log("STaRted");

// Map
var map = L.map('map');
// Markers layer
var markers = null;

//.setView([51.505, -0.09], 13);

// OSM base layer
var osmUrl='http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png';
var osmAttrib='Map data Â© <a href="http://openstreetmap.org">OpenStreetMap</a> contributors';
var osm = new L.TileLayer(osmUrl, {minZoom: 1, maxZoom: 12, attribution: osmAttrib});		
map.addLayer(osm);

// Add the rectangle selection facility
var locationFilter = new L.LocationFilter({ buttonPosition: "bottomleft", adjustButton: null }).addTo(map);

// start the map in South-East England
map.setView([51.3, 0.7], 5);

/*
var addressPoints = [
  [45, 11, "foo"],
  [46, 12, "bar"],
  [47, 13, "baz"],
];
for (var i = 0; i < addressPoints.length; i++) {
  var a = addressPoints[i];
  var title = a[2];
  var marker = L.marker(new L.LatLng(a[0], a[1]), { title: title });
  marker.bindPopup(title);
  markers.addLayer(marker);
}
*/

function set_stations(data)
{
  if (markers != null)
    map.removeLayer(markers);
  markers = null;

  if (!data.length) return;

  markers = L.markerClusterGroup();
  var points = [];

  // Compute the bounding box of the points
  for (var i = 0; i < data.length; ++i)
  {
    var lat = data[i][1];
    var lon = data[i][2];
    points.push([lat, lon]);
    var marker = L.marker(new L.LatLng(lat, lon), { title: data[i][0] });
    markers.addLayer(marker);
  }

  map.addLayer(markers);

  var bounds = L.latLngBounds(points);
  map.fitBounds(bounds);
}

/*

access_token = 'pk.eyJ1Ijoic25vcmZhbG9ycGFndXMiLCJhIjoic1oxRTMxcyJ9.eC6cjtLmFs9EcVwmT1isOQ';
L.tileLayer('https://{s}.tiles.mapbox.com/v4/examples.map-i86nkdio/{z}/{x}/{y}@2x.png?access_token='+access_token, {
    maxZoom: 18,
    attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, ' +
        '<a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
        'Imagery &copy; <a href="http://mapbox.com">Mapbox</a>',
    id: 'examples.map-i86nkdio',
}).addTo(map);

var marker = L.marker(map.getCenter()).addTo(map);
marker.bindPopup("Hello World!").openPopup();

if(typeof MainWindow != 'undefined') {
    var onMapMove = function() { MainWindow.onMapMove(map.getCenter().lat, map.getCenter().lng) };
    map.on('move', onMapMove);
    onMapMove();
}
*/
</script>
</html>
